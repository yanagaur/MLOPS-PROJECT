import{r as y,j as e}from"./@radix-DnFH_oo1.js";import{S as M}from"./plus-Bc8eLSDM.js";import{S as $}from"./trash-DUWZWzse.js";import{q as T,b as Q,a as z,c as L}from"./@tanstack-QbMbTrh5.js";import{l as C,m as w,k as g,n as v,F as N,z as c,a9 as Z,aa as O,ab as R,i as B,I as f,f as h,ap as G,aq as U,ar as H,T as J,v as W,w as _,W as X,x as Y}from"./index-Ci0nJ8EZ.js";import{o as I}from"./url-CbAPzsmT.js";import{t as ee}from"./zod-uFd1wBcd.js";import{u as se,a as te,C as p}from"./index.esm-BE1uqCX5.js";import{C as ae}from"./CodeSnippet-IxXNxUDa.js";async function re({params:s}){const i=C(w.secrets.all+"?"+I(s)),t=await g(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.status===404&&v(),!t.ok){const l=await t.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Failed to fetch secrets");throw new N({status:t.status,statusText:t.statusText,message:l})}return t.json()}async function ie(s){const i=C(w.secrets.detail(s)),t=await g(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.status===404&&v(),!t.ok){const l=await t.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>`Failed to fetch secret ${s}`);throw new N({status:t.status,statusText:t.statusText,message:l})}return t.json()}const j={all:["secrets"],secretList:s=>T({queryKey:[...j.all,s],queryFn:async()=>re({params:s})}),secretDetail:s=>T({queryKey:[...j.all,s],queryFn:async()=>ie(s)})},le=s=>y.createElement("svg",{viewBox:"0 0 20 14",fill:"black",xmlns:"http://www.w3.org/2000/svg",...s},y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.29898 3.86908C4.04374 4.91672 3.16532 6.14781 2.72143 6.85066C2.69198 6.89729 2.67138 6.92996 2.65417 6.95831C2.64281 6.97702 2.63531 6.98996 2.63029 6.99898C2.63029 6.99932 2.63029 6.99966 2.63029 6.99999C2.63029 7.00033 2.63029 7.00067 2.63029 7.001C2.63531 7.01003 2.64281 7.02297 2.65417 7.04168C2.67138 7.07003 2.69198 7.1027 2.72143 7.14933C3.16532 7.85218 4.04374 9.08327 5.29898 10.1309C6.55226 11.1769 8.13098 12 10.0004 12C11.8699 12 13.4486 11.1769 14.7019 10.1309C15.9571 9.08327 16.8355 7.85218 17.2794 7.14933C17.3089 7.1027 17.3295 7.07003 17.3467 7.04168C17.358 7.02297 17.3655 7.01002 17.3705 7.001C17.3705 7.00067 17.3705 7.00033 17.3705 6.99999C17.3705 6.99966 17.3705 6.99932 17.3705 6.99899C17.3655 6.98997 17.358 6.97702 17.3467 6.95831C17.3295 6.92996 17.3089 6.89729 17.2794 6.85066C16.8355 6.14781 15.9571 4.91672 14.7019 3.86908C13.4486 2.82308 11.8699 1.99999 10.0004 1.99999C8.13097 1.99999 6.55226 2.82308 5.29898 3.86908ZM4.23104 2.58952C5.67154 1.38726 7.61569 0.333328 10.0004 0.333328C12.3851 0.333328 14.3293 1.38726 15.7698 2.58952C17.2083 3.79014 18.1946 5.17857 18.6886 5.9607C18.6951 5.97104 18.7018 5.98159 18.7086 5.99236C18.8067 6.14664 18.9339 6.34696 18.9983 6.62764C19.0502 6.85426 19.0502 7.14573 18.9983 7.37235C18.9339 7.65303 18.8067 7.85335 18.7086 8.00763C18.7018 8.01841 18.6951 8.02895 18.6886 8.03929C18.1946 8.82142 17.2083 10.2098 15.7698 11.4105C14.3293 12.6127 12.3851 13.6667 10.0004 13.6667C7.61569 13.6667 5.67154 12.6127 4.23104 11.4105C2.7925 10.2098 1.80622 8.82142 1.31227 8.03929C1.30574 8.02895 1.29904 8.01841 1.2922 8.00764C1.19418 7.85335 1.06692 7.65303 1.00258 7.37235C0.950637 7.14573 0.950637 6.85426 1.00258 6.62764C1.06692 6.34696 1.19418 6.14664 1.2922 5.99235C1.29904 5.98158 1.30574 5.97104 1.31227 5.9607C1.80622 5.17857 2.7925 3.79014 4.23104 2.58952ZM10.0004 5.33333C9.07994 5.33333 8.33375 6.07952 8.33375 6.99999C8.33375 7.92047 9.07994 8.66666 10.0004 8.66666C10.9209 8.66666 11.6671 7.92047 11.6671 6.99999C11.6671 6.07952 10.9209 5.33333 10.0004 5.33333ZM6.66708 6.99999C6.66708 5.15905 8.15947 3.66666 10.0004 3.66666C11.8414 3.66666 13.3338 5.15905 13.3338 6.99999C13.3338 8.84094 11.8414 10.3333 10.0004 10.3333C8.15947 10.3333 6.66708 8.84094 6.66708 6.99999Z"})),ne=c.object({secretName:c.string().min(1,"Secret Name is required"),keysValues:c.array(c.object({key:c.string().min(1,"Key is required"),value:c.string().min(1,"Value is required"),showPassword:c.boolean().optional()}))});async function oe(s,i){const t=C(w.secrets.detail(s)),l=await g(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.status===404&&v(),!l.ok)throw new N({message:"Error updating secret",status:l.status,statusText:l.statusText});return l.json()}function ce(s){return Q({mutationFn:async({id:i,body:t})=>oe(i,t),...s})}function we({secretId:s,isSecretNameEditable:i,dialogTitle:t}){return e.jsxs(Z,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(O,{children:e.jsx(R,{children:t})}),e.jsx(ue,{secretId:s,isSecretNameEditable:i})]})}function ue({secretId:s,isSecretNameEditable:i}){const{data:t,isLoading:l,isError:n}=z({...j.secretDetail(s)}),{handleSubmit:V,control:u,setValue:m,watch:b,formState:{isValid:E}}=se({resolver:ee(ne),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:x,append:q,remove:D}=te({control:u,name:"keysValues"});y.useEffect(()=>{var a;t&&(m("secretName",t.name),m("keysValues",Object.entries(((a=t.body)==null?void 0:a.values)||{}).map(([r,o])=>({key:r,value:String(o)}))))},[t,m]);const F=()=>{q({key:"",value:"",showPassword:!1})},{toast:k}=B(),S=L(),{mutate:P}=ce({onError(a){H(a)&&k({status:"error",emphasis:"subtle",description:a.message,rounded:!0})},onSuccess(){k({status:"success",emphasis:"subtle",description:"Secret updated successfull",rounded:!0}),S.invalidateQueries({queryKey:["secrets"]}),S.invalidateQueries({queryKey:["secretDetail",s]})}}),K=a=>{const r={name:a.secretName,scope:"workspace",values:a.keysValues.reduce((o,d)=>(d.key&&d.value&&(o[d.key]=d.value),o),{})};P({id:s,body:r})},A=a=>{const r=b(`keysValues.${a}.showPassword`);m(`keysValues.${a}.showPassword`,!r)};return l?e.jsx("p",{children:"Loading..."}):n?e.jsx("p",{children:"Error fetching secret details."}):e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"edit-secret-form",className:"gap-5 p-5",onSubmit:V(K),children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(p,{name:"secretName",control:u,render:({field:a})=>e.jsx(f,{...a,className:"mb-3 w-full",required:!0,disabled:!i})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),x.map((a,r)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(p,{name:`keysValues.${r}.key`,control:u,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{name:`keysValues.${r}.value`,control:u,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:b(`keysValues.${r}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>A(r),className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(le,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[r===x.length-1&&e.jsx(h,{intent:"primary",emphasis:"subtle",onClick:F,className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(M,{className:"flex-shrink-0 fill-primary-600"})}),r!==x.length-1&&e.jsx(h,{intent:"secondary",emphasis:"minimal",onClick:()=>D(r),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx($,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},a.id))]})}),e.jsxs(G,{className:"gap-[10px]",children:[e.jsx(U,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"primary",type:"submit",form:"edit-secret-form",disabled:!E,children:"Save Secret"})]})]})}function ge({code:s}){return e.jsx(J,{children:e.jsxs(W,{children:[e.jsx(_,{children:e.jsx(X,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})}),e.jsxs(Y,{className:"z-50 flex max-w-[480px] flex-col gap-2 bg-theme-surface-primary p-5 text-text-sm text-theme-text-primary",children:[e.jsx("p",{className:"text-md text-theme-text-primary",children:"To use your secret in a step, you can use the following code:"}),e.jsx(ae,{highlightCode:!0,wrap:!0,codeClasses:"break-words",code:s}),e.jsx("a",{className:"link w-fit text-primary-400",target:"_blank",href:"https://docs.zenml.io/how-to/interact-with-secrets#accessing-registered-secrets",children:"Learn More"})]})]})})}export{we as E,le as S,ge as a,j as b,ne as s,ce as u};
